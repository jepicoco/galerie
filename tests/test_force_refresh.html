<!DOCTYPE html>
<html>
<head>
    <title>Test Force Refresh</title>
</head>
<body>
    <h1>Test du Force Refresh apr√®s Paiement</h1>

    <script>
        // Simuler les variables globales
        window.currentStatus = 'unpaid';
        let isLoadingTab = false;

        // Simuler switchTab avec la nouvelle logique
        window.switchTab = async function(status, forceRefresh = false) {
            console.log('üîÑ switchTab appel√©e avec status:', status, 'forceRefresh:', forceRefresh);
            console.log('üìä Statut actuel (currentStatus):', window.currentStatus);
            console.log('‚è≥ isLoadingTab:', isLoadingTab);

            if (isLoadingTab) {
                console.log('‚ùå Abandon - d√©j√† en cours de chargement');
                return;
            }

            if (window.currentStatus === status && !forceRefresh) {
                console.log('‚ùå Abandon - m√™me statut et pas de forceRefresh');
                return;
            }

            if (forceRefresh) {
                console.log('üîÑ Force refresh activ√© - continuation malgr√© le m√™me statut');
            }

            console.log('‚úÖ Rafra√Æchissement en cours...');
            // Simuler le rafra√Æchissement
            return Promise.resolve('success');
        };

        // Test 1: Appel normal (devrait √™tre bloqu√©)
        console.log('\n=== Test 1: Appel normal avec m√™me statut ===');
        window.switchTab('unpaid');

        // Test 2: Appel avec forceRefresh (devrait passer)
        console.log('\n=== Test 2: Appel avec forceRefresh ===');
        window.switchTab('unpaid', true);

        // Test 3: Simulation compl√®te du paiement
        console.log('\n=== Test 3: Simulation post-paiement ===');
        setTimeout(() => {
            console.log('üéâ Simulation: Paiement trait√© avec succ√®s');
            console.log('‚è±Ô∏è D√©marrage du timeout de 500ms...');
            setTimeout(() => {
                console.log('üîÑ Timeout √©coul√©, v√©rification de switchTab...');
                console.log('typeof window.switchTab:', typeof window.switchTab);
                console.log('window.currentStatus:', window.currentStatus);

                if (typeof window.switchTab === 'function') {
                    console.log('‚úÖ switchTab trouv√©e, appel avec status:', window.currentStatus || 'unpaid');
                    // Nouvelle logique avec forceRefresh=true
                    window.switchTab(window.currentStatus || 'unpaid', true);
                } else {
                    console.log('‚ùå switchTab non trouv√©e');
                }
            }, 500);
        }, 1000);
    </script>

    <p>Ouvrez la console pour voir les r√©sultats du test.</p>
</body>
</html>